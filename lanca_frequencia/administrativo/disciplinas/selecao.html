<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <title>Selecionar Cursos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="../../../extra/css/principal.css" />
</head>

<body>
  <div class="container py-5">

    <!-- Cabeçalho -->
    <div class="row mb-4 align-items-center">
      <div class="col">
        <h1 class="h2 mb-0">
          <i class="bi bi-list-check me-2"></i>Selecionar Cursos
        </h1>
      </div>
      <div class="col-auto d-flex gap-2">
        <button class="btn btn-outline-primary" onclick="window.location.href='/'">
          <i class="bi bi-list me-1"></i> Menu
        </button>
        <button class="btn btn-outline-danger" onclick="logout()">
          <i class="bi bi-box-arrow-right me-1"></i> Sair
        </button>
      </div>
    </div>

    <!-- Mensagem de erro -->
    <div id="error-message" class="alert alert-danger d-none" role="alert"></div>

    <!-- Lista de cursos -->
    <div class="list-group shadow-sm" id="listaCursos">
      <div class="text-muted p-3">Carregando cursos...</div>
    </div>

  </div>

  <!-- Scripts -->
  <script src="../../../extra/js/logout.js"></script>
  <script src="../../../extra/js/fetchComToken.js"></script>
  <script src="../../../extra/js/refreshAccessToken.js"></script>
  <script>
    async function carregarCursos() {
      const lista = document.getElementById("listaCursos");
      const errorMsg = document.getElementById("error-message");

      lista.innerHTML = `<div class="text-muted p-3">Carregando cursos...</div>`;
      errorMsg.classList.add("d-none");
      errorMsg.textContent = "";

      try {
        const response = await fetchComToken("/backend/lanca_frequencia/cursos/", {
          method: "GET",
          credentials: "include",
        });

        if (!response.ok) {
          throw new Error("Erro ao buscar cursos disponíveis.");
        }

        const dados = await response.json();

        if (!dados.length) {
          lista.innerHTML = `<div class="alert alert-info m-0">Nenhum curso encontrado.</div>`;
          return;
        }

        lista.innerHTML = "";
        dados.forEach((curso) => {
          const link = document.createElement("a");
          link.href = `disciplinas.html?curso=${curso.id}`;
          link.className = "list-group-item list-group-item-action d-flex justify-content-between align-items-center";
          link.innerHTML = `
            ${curso.nome}
            <i class="bi bi-chevron-right"></i>
          `;
          lista.appendChild(link);
        });

      } catch (error) {
        lista.innerHTML = "";
        errorMsg.textContent = error.message;
        errorMsg.classList.remove("d-none");
      }
    }

    document.addEventListener("DOMContentLoaded", carregarCursos);
  </script>
</body>

</html>