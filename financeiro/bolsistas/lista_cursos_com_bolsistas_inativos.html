<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cursos com Bolsistas Inativos</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="../../extra/css/principal.css" />
</head>

<body>
    <div class="container py-5">

        <!-- Cabeçalho -->
        <div class="row mb-4 align-items-center">
            <div class="col">
                <h1 class="h2 mb-0">
                    <i class="bi bi-book me-2"></i>Cursos com Bolsistas Inativos
                </h1>
            </div>
            <div class="col-auto d-flex gap-2">
                <a href="menu.html" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-1"></i> Voltar
                </a>
                <button class="btn btn-outline-danger" onclick="logout()">
                    <i class="bi bi-box-arrow-right me-1"></i> Sair
                </button>
            </div>
        </div>

        <!-- Alert -->
        <div id="error-message" class="alert alert-danger d-none" role="alert"></div>

        <!-- Tabela -->
        <div class="table-responsive shadow-sm">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Nome do Curso</th>
                        <th class="text-end">Ações</th>
                    </tr>
                </thead>
                <tbody id="cursos-list">
                    <tr>
                        <td colspan="2" class="text-center py-4 text-muted">
                            Carregando cursos...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

    <!-- Scripts -->
    <script src="../../extra/js/logout.js"></script>
    <script src="../../extra/js/fetchComToken.js"></script>
    <script src="../../extra/js/refreshAccessToken.js"></script>
    <script>
        async function carregarCursosComBolsistasInativos() {
            const tabela = document.getElementById("cursos-list");
            const errorMsg = document.getElementById("error-message");

            tabela.innerHTML = `<tr><td colspan="2" class="text-center py-4 text-muted">Carregando cursos...</td></tr>`;
            errorMsg.classList.add("d-none");
            errorMsg.textContent = "";

            try {
                let response = await fetchComToken("/backend/financeiro/bolsistas/inativos/", {
                    method: "GET",
                    credentials: "include",
                });

                if (response.status === 401) {
                    await refreshAccessToken();
                    response = await fetchComToken("/backend/financeiro/bolsistas/inativos/", {
                        method: "GET",
                        credentials: "include",
                    });
                }

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || "Erro ao buscar cursos com bolsistas inativos");
                }

                const cursosInativos = await response.json();
                tabela.innerHTML = "";

                if (!Array.isArray(cursosInativos) || cursosInativos.length === 0) {
                    tabela.innerHTML = `<tr><td colspan="2" class="text-center py-4 text-muted">Nenhum curso com bolsistas inativos encontrado.</td></tr>`;
                    return;
                }

                cursosInativos.forEach((curso) => {
                    tabela.insertAdjacentHTML("beforeend", `
            <tr>
              <td>${curso.nome}</td>
              <td class="text-end">
                <a href="curso_com_bolsistas_inativos.html?id=${encodeURIComponent(curso.id)}" class="btn btn-sm btn-info">
                  <i class="bi bi-info-circle"></i> Ver Bolsistas
                </a>
              </td>
            </tr>
          `);
                });

            } catch (error) {
                errorMsg.textContent = error.message;
                errorMsg.classList.remove("d-none");
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const token = localStorage.getItem("token");
            if (!token) return logout();
            carregarCursosComBolsistasInativos();
        });
    </script>
</body>

</html>